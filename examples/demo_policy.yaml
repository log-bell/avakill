# AvaKill Demo Policy
# Used by all example scripts. Covers common real-world patterns:
#   - Block destructive operations (delete_*, remove_*, destroy_*)
#   - Block destructive SQL (DROP, DELETE, TRUNCATE, ALTER)
#   - Block dangerous shell commands (rm -rf, sudo, etc.)
#   - Allow read/search operations
#   - Rate-limit web searches

version: "1.0"
default_action: deny

policies:
  # --- Deny rules first (first-match-wins) ---
  - name: "block-destructive-ops"
    tools: ["delete_*", "remove_*", "destroy_*", "drop_*"]
    action: deny
    message: "Destructive operations are blocked. Run manually or update your policy."

  - name: "block-destructive-sql"
    tools: ["execute_sql", "database_execute", "run_query"]
    action: deny
    conditions:
      args_match:
        query: ["DROP", "DELETE", "TRUNCATE", "ALTER"]
    message: "Destructive SQL blocked. Use a manual migration."

  - name: "block-dangerous-shells"
    tools: ["shell_execute", "run_command", "execute_command"]
    action: deny
    conditions:
      args_match:
        command: ["rm -rf", "sudo", "chmod 777", "> /dev/"]
    message: "Dangerous shell command blocked."

  # --- Rate limit before allows (first-match-wins) ---
  - name: "rate-limit-search"
    tools: ["web_search"]
    action: allow
    rate_limit:
      max_calls: 10
      window: "60s"

  # --- Allow rules after denies ---
  - name: "allow-reads"
    tools: ["search_*", "get_*", "list_*", "read_*", "query_*", "fetch_*",
            "*_search", "*_get", "*_list", "*_read", "*_query", "*_fetch"]
    action: allow

  - name: "allow-safe-sql"
    tools: ["execute_sql", "database_execute", "run_query"]
    action: allow

  - name: "allow-safe-shells"
    tools: ["shell_execute", "run_command", "execute_command"]
    action: allow
