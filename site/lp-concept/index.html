<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AvaKill — The AI Safety Firewall</title>
  <meta name="description" content="AvaKill — Open-source safety firewall for AI agents. Intercept tool calls, enforce policies, prevent disasters.">
  <meta property="og:title" content="AvaKill — Open-Source Safety Firewall for AI Agents">
  <meta property="og:description" content="Intercept tool calls. Enforce policies. Prevent disasters. Works with OpenAI, Anthropic, LangChain, MCP.">
  <meta property="og:type" content="website">
  <link rel="icon" type="image/png" href="../favicon/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/svg+xml" href="../favicon/favicon.svg">
  <link rel="shortcut icon" href="../favicon/favicon.ico">
  <link rel="apple-touch-icon" sizes="180x180" href="../favicon/apple-touch-icon.png">
  <link rel="manifest" href="../favicon/site.webmanifest">
  <link href="https://api.fontshare.com/v2/css?f[]=satoshi@400,500,700,900&display=swap" rel="stylesheet">
  <style>
    /* =========================================================
       CSS Custom Properties
       ========================================================= */
    :root {
      /* Core Brand */
      --neon-blue: #00D4FF;
      --neon-blue-bright: #00F5FF;
      --neon-blue-dim: #0088CC;

      /* Backgrounds */
      --base-dark: #0A0F1E;
      --surface: #111827;
      --surface-elevated: #1A1F3A;
      --subtle-blue-tint: #0D1B3D;

      /* Porcelain (from logo) */
      --porcelain-warm: #F0E6D8;
      --porcelain-mid: #E8E0D4;
      --porcelain-shadow: #D4C4B0;

      /* Text */
      --text-primary: #F8F8F8;
      --text-secondary: #9CA3AF;
      --text-muted: #6B7280;

      /* Semantic */
      --color-allowed: #22C55E;
      --color-denied: #EF4444;
      --color-pending: #F59E0B;
      --color-info: #00D4FF;

      /* Hair / Dark Fills */
      --navy-black: #0B1029;
      --navy-mid: #1A1F45;

      /* Dress / Neutral */
      --cool-gray: #C8CCD8;

      /* Code Blocks / Terminal */
      --code-bg: #0D1117;
      --code-text: #E6EDF3;
    }

    /* =========================================================
       Reset & Base
       ========================================================= */
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: 'Satoshi', system-ui, -apple-system, sans-serif;
      background: var(--base-dark);
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* =========================================================
       Particle Canvas
       ========================================================= */
    #particle-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      pointer-events: none;
    }

    /* =========================================================
       Zone Containers
       ========================================================= */
    .zone {
      position: relative;
      width: 100%;
      z-index: 1;
    }

    /* =========================================================
       Zone 1: The Agent Layer
       ========================================================= */
    .zone-1 {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 80px 24px 40px;
      position: relative;
      overflow: hidden;
    }

    .z1-agents {
      display: flex;
      gap: 48px;
      margin-bottom: 60px;
      position: relative;
      z-index: 1;
    }

    .z1-agent {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      opacity: 0;
      animation: fadeInDown 0.6s ease forwards;
    }

    .z1-agent:nth-child(1) { animation-delay: 0.1s; }
    .z1-agent:nth-child(2) { animation-delay: 0.25s; }
    .z1-agent:nth-child(3) { animation-delay: 0.4s; }
    .z1-agent:nth-child(4) { animation-delay: 0.55s; }

    .z1-agent-icon {
      width: 56px;
      height: 56px;
      border-radius: 16px;
      background: var(--surface-elevated);
      border: 1px solid rgba(0, 212, 255, 0.15);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .z1-agent-icon svg {
      width: 28px;
      height: 28px;
      stroke: var(--neon-blue);
      stroke-width: 1.5;
      fill: none;
      stroke-linecap: round;
      stroke-linejoin: round;
    }

    .z1-agent span {
      font-size: 0.8rem;
      color: var(--text-muted);
      font-weight: 500;
    }

    .z1-copy {
      text-align: center;
      max-width: 700px;
      position: relative;
      z-index: 1;
      opacity: 0;
      animation: fadeInUp 0.8s ease 0.6s forwards;
    }

    .z1-headline {
      font-size: clamp(2rem, 5vw, 3.5rem);
      font-weight: 900;
      letter-spacing: -0.03em;
      line-height: 1.1;
      margin-bottom: 20px;
      color: var(--text-primary);
    }

    .z1-sub {
      font-size: 1.1rem;
      line-height: 1.7;
      color: var(--text-secondary);
    }

    .z1-packet-field {
      position: absolute;
      inset: 0;
      pointer-events: none;
      z-index: 0;
    }

    @keyframes fadeInDown {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* =========================================================
       Zone 1: Tool Call Packets
       ========================================================= */
    .packet {
      position: absolute;
      top: 0;
      padding: 6px 14px;
      font-family: 'SF Mono', 'Fira Code', 'Cascadia Code', monospace;
      font-size: 0.75rem;
      border-radius: 6px;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      border: 1px solid rgba(0, 212, 255, 0.12);
      background: rgba(13, 17, 23, 0.85);
      color: var(--code-text);
      box-shadow: 0 0 12px rgba(0, 212, 255, 0.08);
    }

    .packet[data-danger="true"] {
      border-color: rgba(239, 68, 68, 0.25);
      box-shadow: 0 0 12px rgba(239, 68, 68, 0.1);
      color: #fca5a5;
    }

    .packet[data-danger="false"] {
      border-color: rgba(34, 197, 94, 0.2);
      box-shadow: 0 0 12px rgba(34, 197, 94, 0.08);
      color: #86efac;
    }

    /* =========================================================
       Zone 2: The Firewall
       ========================================================= */
    .zone-2 {
      min-height: 200vh;
      position: relative;
    }

    .z2-sticky-wrap {
      position: sticky;
      top: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    /* ---- Ava Mascot ---- */
    .z2-ava {
      position: relative;
      width: 160px;
      height: 160px;
      margin-bottom: 32px;
      z-index: 2;
      /* Initial state — driven by JS */
      transform: scale(0);
      opacity: 0;
    }

    .z2-ava-img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      position: relative;
      z-index: 2;
    }

    /* Pulsing glow behind Ava */
    .z2-ava::before {
      content: '';
      position: absolute;
      inset: -30px;
      background: radial-gradient(circle, rgba(0, 212, 255, 0.2) 0%, transparent 70%);
      animation: z2PulseGlow 3s ease-in-out infinite;
      z-index: 0;
      border-radius: 50%;
    }

    @keyframes z2PulseGlow {
      0%, 100% { opacity: 0.5; }
      50% { opacity: 1; }
    }

    /* ---- Shield Barrier ---- */
    .z2-shield {
      width: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--neon-blue), transparent);
      box-shadow:
        0 0 20px rgba(0, 212, 255, 0.4),
        0 0 60px rgba(0, 212, 255, 0.15);
      z-index: 1;
      opacity: 0;
      margin-bottom: 32px;
    }

    /* ---- Copy ---- */
    .z2-copy {
      text-align: center;
      z-index: 2;
      /* Initial state — driven by JS */
      opacity: 0;
      transform: translateY(20px);
    }

    .z2-headline {
      font-size: clamp(1.8rem, 4vw, 3rem);
      font-weight: 900;
      letter-spacing: -0.02em;
      color: var(--text-primary);
      margin-bottom: 12px;
    }

    .z2-sub {
      font-size: 1rem;
      color: var(--text-secondary);
    }

    /* ---- Interception area (populated in Task 6) ---- */
    .z2-intercept-area {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      display: flex;
      flex-direction: column;
      gap: 10px;
      width: 90%;
      max-width: 520px;
      pointer-events: none;
      z-index: 3;
      opacity: 0;
    }

    /* ---- Architecture area (populated in Task 7) ---- */
    .z2-architecture {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 90%;
      max-width: 700px;
      z-index: 3;
      opacity: 0;
    }

    /* =========================================================
       Zone 2B: Interceptions
       ========================================================= */
    .z2-intercept {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 16px;
      background: var(--code-bg);
      border: 1px solid rgba(0, 212, 255, 0.1);
      border-radius: 8px;
      font-family: 'SF Mono', 'Fira Code', 'Cascadia Code', monospace;
      font-size: 0.8rem;
      opacity: 0;
      transform: translateY(-20px);
    }

    .z2-intercept[data-result="allowed"] {
      border-color: rgba(34, 197, 94, 0.3);
    }

    .z2-intercept[data-result="denied"] {
      border-color: rgba(239, 68, 68, 0.3);
    }

    .z2-intercept[data-result="ratelimited"] {
      border-color: rgba(245, 158, 11, 0.3);
    }

    .z2-intercept-label {
      flex: 1;
      color: var(--code-text);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .z2-intercept-badge {
      font-weight: 700;
      font-size: 0.7rem;
      padding: 2px 10px;
      border-radius: 4px;
      white-space: nowrap;
      flex-shrink: 0;
    }

    .z2-intercept[data-result="allowed"] .z2-intercept-badge {
      color: var(--color-allowed);
      background: rgba(34, 197, 94, 0.1);
    }

    .z2-intercept[data-result="denied"] .z2-intercept-badge {
      color: var(--color-denied);
      background: rgba(239, 68, 68, 0.1);
    }

    .z2-intercept[data-result="ratelimited"] .z2-intercept-badge {
      color: var(--color-pending);
      background: rgba(245, 158, 11, 0.1);
    }

    .z2-intercept-rule {
      font-size: 0.65rem;
      color: var(--text-muted);
      white-space: nowrap;
      flex-shrink: 0;
    }

    /* =========================================================
       Zone 2C: Architecture Reveal
       ========================================================= */
    .z2-arch {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 32px;
    }

    .z2-arch-center {
      text-align: center;
    }

    .z2-arch-yaml {
      display: inline-block;
      padding: 10px 24px;
      background: var(--code-bg);
      border: 1px solid var(--neon-blue);
      border-radius: 8px;
      font-family: 'SF Mono', 'Fira Code', 'Cascadia Code', monospace;
      font-size: 1rem;
      font-weight: 700;
      color: var(--neon-blue);
      box-shadow: 0 0 20px rgba(0, 212, 255, 0.2);
    }

    .z2-arch-subtitle {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: 8px;
    }

    .z2-arch-branches {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      width: 100%;
    }

    .z2-arch-branch {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0;
    }

    .z2-arch-line {
      width: 2px;
      height: 0;
      background: var(--neon-blue);
      box-shadow: 0 0 8px rgba(0, 212, 255, 0.4);
      margin-bottom: 12px;
    }

    .z2-arch-line--dashed {
      background: repeating-linear-gradient(
        to bottom,
        var(--neon-blue) 0px,
        var(--neon-blue) 4px,
        transparent 4px,
        transparent 8px
      );
      box-shadow: 0 0 6px rgba(0, 212, 255, 0.2);
    }

    .z2-arch-node {
      background: var(--code-bg);
      border: 1px solid rgba(0, 212, 255, 0.15);
      border-radius: 8px;
      padding: 14px 16px;
      text-align: center;
      opacity: 0;
      width: 100%;
    }

    .z2-arch-branch--optional .z2-arch-node {
      border-style: dashed;
      opacity: 0;
    }

    .z2-arch-node strong {
      display: block;
      color: var(--neon-blue);
      font-size: 0.85rem;
      margin-bottom: 4px;
    }

    .z2-arch-node span {
      display: block;
      color: var(--text-secondary);
      font-size: 0.75rem;
      margin-bottom: 4px;
    }

    .z2-arch-node small {
      display: block;
      color: var(--text-muted);
      font-size: 0.65rem;
      font-style: italic;
    }

    .z2-arch-copy {
      text-align: center;
      font-size: 1rem;
      color: var(--text-secondary);
      line-height: 1.6;
      opacity: 0;
    }

    /* =========================================================
       Zone 3: The Protected World
       ========================================================= */
    .zone-3 {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .z3-content {
      max-width: 700px;
      width: 90%;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 40px;
    }

    .z3-headline {
      font-size: clamp(1.8rem, 4vw, 2.8rem);
      font-weight: 900;
      letter-spacing: -0.02em;
      color: var(--text-primary);
      opacity: 0;
      transform: translateY(20px);
    }

    .z3-sub {
      font-size: 1.05rem;
      line-height: 1.7;
      color: var(--text-secondary);
      margin-top: -24px;
      opacity: 0;
      transform: translateY(20px);
    }

    /* ---- Constellation ---- */
    .z3-constellation {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      width: 100%;
    }

    .z3-node {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px 16px;
      background: var(--code-bg);
      border: 1px solid rgba(0, 212, 255, 0.1);
      border-radius: 8px;
      opacity: 0;
      transform: translateY(15px);
      transition: box-shadow 0.4s ease;
    }

    .z3-node::before {
      content: '';
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--dot-color, var(--neon-blue));
      flex-shrink: 0;
    }

    .z3-node span {
      font-size: 0.8rem;
      font-weight: 500;
      color: var(--text-secondary);
      white-space: nowrap;
    }

    .z3-node.pulse {
      box-shadow: 0 0 20px rgba(34, 197, 94, 0.3);
    }

    /* Last row: 3 items — center them */
    .z3-constellation .z3-node:nth-child(5) {
      grid-column: 1 / 2;
    }
    .z3-constellation .z3-node:nth-child(6) {
      grid-column: 2 / 3;
    }
    .z3-constellation .z3-node:nth-child(7) {
      grid-column: 3 / 4;
    }

    /* ---- YAML Snippet ---- */
    .z3-yaml {
      width: 100%;
      max-width: 440px;
      background: var(--code-bg);
      border: 1px solid rgba(0, 212, 255, 0.1);
      border-radius: 10px;
      overflow: hidden;
      text-align: left;
      opacity: 0;
      transform: translateY(15px);
    }

    .z3-yaml-header {
      padding: 8px 16px;
      background: #161B22;
      font-family: 'SF Mono', 'Fira Code', 'Cascadia Code', monospace;
      font-size: 0.75rem;
      color: var(--text-muted);
      border-bottom: 1px solid rgba(0, 212, 255, 0.06);
    }

    .z3-yaml pre {
      padding: 16px 20px;
      margin: 0;
      font-family: 'SF Mono', 'Fira Code', 'Cascadia Code', monospace;
      font-size: 0.8rem;
      line-height: 1.6;
      color: var(--code-text);
      overflow-x: auto;
    }

    .z3-yaml code {
      font-family: inherit;
    }

    .zone-4 { min-height: 100vh; }

    /* =========================================================
       Footer
       ========================================================= */
    .footer {
      position: relative;
      z-index: 1;
      text-align: center;
      padding: 2rem 1rem;
      border-top: 1px solid var(--surface-elevated);
    }

    .footer-links {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.75rem;
    }

    .footer-links a {
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 0.875rem;
      transition: color 0.2s;
    }

    .footer-links a:hover {
      color: var(--neon-blue);
    }

    .footer-links .sep {
      color: var(--text-muted);
    }

    .footer-attribution {
      color: var(--text-muted);
      font-size: 0.75rem;
    }
  </style>
</head>
<body>
  <canvas id="particle-canvas"></canvas>
  <main>
    <section class="zone zone-1" id="zone-1">
      <div class="z1-agents" id="z1-agents">
        <div class="z1-agent" data-agent="claude">
          <div class="z1-agent-icon">
            <svg viewBox="0 0 24 24"><polyline points="4 17 10 11 4 5"/><line x1="12" y1="19" x2="20" y2="19"/></svg>
          </div>
          <span>Claude Code</span>
        </div>
        <div class="z1-agent" data-agent="gemini">
          <div class="z1-agent-icon">
            <svg viewBox="0 0 24 24"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
          </div>
          <span>Gemini CLI</span>
        </div>
        <div class="z1-agent" data-agent="windsurf">
          <div class="z1-agent-icon">
            <svg viewBox="0 0 24 24"><path d="M9.59 4.59A2 2 0 1 1 11 8H2m10.59 11.41A2 2 0 1 0 14 16H2m15.73-8.27A2.5 2.5 0 1 1 19.5 12H2"/></svg>
          </div>
          <span>Windsurf</span>
        </div>
        <div class="z1-agent" data-agent="codex">
          <div class="z1-agent-icon">
            <svg viewBox="0 0 24 24"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
          </div>
          <span>Codex</span>
        </div>
      </div>

      <div class="z1-copy">
        <h1 class="z1-headline">Your agents make thousands of tool calls.</h1>
        <p class="z1-sub">Every one of them reaches your files, databases, and infrastructure.<br>Who decides what gets through?</p>
      </div>

      <div class="z1-packet-field" id="z1-packet-field"></div>
    </section>
    <section class="zone zone-2" id="zone-2">
      <!-- Sticky container — sticks during scroll through zone-2 -->
      <div class="z2-sticky-wrap">
        <div class="z2-ava" id="z2-ava">
          <img src="../avakill-logo.png" alt="AvaKill" class="z2-ava-img">
        </div>

        <!-- Shield barrier — glowing line stretching edge to edge -->
        <div class="z2-shield" id="z2-shield"></div>

        <div class="z2-copy" id="z2-copy">
          <h2 class="z2-headline">Meet your firewall.</h2>
          <p class="z2-sub">One YAML policy. Three enforcement paths. &lt;1ms.</p>
        </div>

        <!-- Interception events will be added in Task 6 -->
        <div class="z2-intercept-area" id="z2-intercept-area"></div>

        <!-- Architecture diagram will be added in Task 7 -->
        <div class="z2-architecture" id="z2-architecture">
          <div class="z2-arch">
            <div class="z2-arch-center">
              <div class="z2-arch-yaml">avakill.yaml</div>
              <div class="z2-arch-subtitle">one policy file</div>
            </div>

            <div class="z2-arch-branches">
              <div class="z2-arch-branch" data-branch="hooks">
                <div class="z2-arch-line"></div>
                <div class="z2-arch-node">
                  <strong>Hooks</strong>
                  <span>Claude Code, Cursor, Windsurf, Gemini, Codex</span>
                  <small>work standalone, evaluate in-process</small>
                </div>
              </div>

              <div class="z2-arch-branch" data-branch="mcp">
                <div class="z2-arch-line"></div>
                <div class="z2-arch-node">
                  <strong>MCP Proxy</strong>
                  <span>wraps MCP servers</span>
                  <small>works standalone, evaluate in-process</small>
                </div>
              </div>

              <div class="z2-arch-branch" data-branch="sandbox">
                <div class="z2-arch-line"></div>
                <div class="z2-arch-node">
                  <strong>OS Sandbox</strong>
                  <span>launch + profiles</span>
                  <small>works standalone, OS-level enforcement</small>
                </div>
              </div>

              <div class="z2-arch-branch z2-arch-branch--optional" data-branch="daemon">
                <div class="z2-arch-line z2-arch-line--dashed"></div>
                <div class="z2-arch-node">
                  <strong>Daemon</strong>
                  <span>optional</span>
                  <small>shared evaluation, audit logging, visibility</small>
                </div>
              </div>
            </div>

            <p class="z2-arch-copy">One policy file. Three independent enforcement paths.<br>No single point of failure.</p>
          </div>
        </div>
      </div>
    </section>
    <section class="zone zone-3" id="zone-3">
      <div class="z3-content">
        <h2 class="z3-headline">Only what you approve gets through.</h2>
        <p class="z3-sub">Your databases. Your files. Your infrastructure.<br>Protected by rules you write in YAML.</p>

        <div class="z3-constellation" id="z3-constellation">
          <div class="z3-node" style="--dot-color: #336791;"><span>PostgreSQL</span></div>
          <div class="z3-node" style="--dot-color: #4479A1;"><span>MySQL</span></div>
          <div class="z3-node" style="--dot-color: #FF9900;"><span>AWS</span></div>
          <div class="z3-node" style="--dot-color: #4285F4;"><span>GCP</span></div>
          <div class="z3-node" style="--dot-color: #9CA3AF;"><span>File System</span></div>
          <div class="z3-node" style="--dot-color: #A855F7;"><span>Shell / CLI</span></div>
          <div class="z3-node" style="--dot-color: #14B8A6;"><span>REST APIs</span></div>
        </div>

        <div class="z3-yaml" id="z3-yaml">
          <div class="z3-yaml-header">avakill.yaml</div>
          <pre><code>rules:
  - tool: bash
    deny: true
    pattern: "rm -rf|DROP TABLE|shutdown"

  - tool: fs.write
    allow: ["/tmp/*", "/app/data/*"]

  - tool: "*"
    rate_limit: 100/minute</code></pre>
        </div>
      </div>
    </section>
    <section class="zone zone-4" id="zone-4"><!-- The Proof --></section>
  </main>
  <footer class="footer">
    <nav class="footer-links">
      <a href="https://github.com/log-bell/avakill/blob/main/docs/getting-started.md">Docs</a>
      <span class="sep">&middot;</span>
      <a href="https://github.com/log-bell/avakill">GitHub</a>
      <span class="sep">&middot;</span>
      <a href="https://pypi.org/project/avakill/">PyPI</a>
      <span class="sep">&middot;</span>
      <a href="https://discord.gg/gTBvbkSV2">Discord</a>
    </nav>
    <div class="footer-attribution">
      Built with &#128737;&#65039; by AvaKill contributors. Open-source under AGPL-3.0.
    </div>
  </footer>
  <script>
    /* ===== Scroll Engine =====
     * Tracks scroll position and calculates per-zone progress (0–1).
     * All animations read from `zoneProgress` on each frame.
     */
    const zones = {};
    const zoneProgress = { z1: 0, z2: 0, z2a: 0, z2b: 0, z2c: 0, z3: 0, z4: 0 };

    function initZones() {
      ['zone-1', 'zone-2', 'zone-3', 'zone-4'].forEach(id => {
        const el = document.getElementById(id);
        if (el) zones[id] = el;
      });
    }

    function updateProgress() {
      const scrollY = window.scrollY;
      const vh = window.innerHeight;

      for (const [id, el] of Object.entries(zones)) {
        const top = el.offsetTop;
        const height = el.offsetHeight;
        // Progress: 0 when zone top hits viewport bottom, 1 when zone bottom hits viewport top
        const raw = (scrollY + vh - top) / (height + vh);
        const key = id.replace('zone-', 'z');
        zoneProgress[key] = Math.max(0, Math.min(1, raw));
      }

      // Sub-zones for Zone 2 (split into thirds: 2a, 2b, 2c)
      const z2El = zones['zone-2'];
      if (z2El) {
        const z2Top = z2El.offsetTop;
        const z2Height = z2El.offsetHeight;
        const z2Scroll = scrollY - z2Top + vh;
        const third = z2Height / 3;
        zoneProgress.z2a = Math.max(0, Math.min(1, z2Scroll / third));
        zoneProgress.z2b = Math.max(0, Math.min(1, (z2Scroll - third) / third));
        zoneProgress.z2c = Math.max(0, Math.min(1, (z2Scroll - 2 * third) / third));
      }
    }

    // Animation callbacks registered by each zone
    const frameCallbacks = [];
    function onFrame(cb) { frameCallbacks.push(cb); }

    let ticking = false;
    function tick() {
      updateProgress();
      for (const cb of frameCallbacks) cb(zoneProgress);
      ticking = false;
    }

    // Use rAF-throttled scroll listener for performance
    window.addEventListener('scroll', () => {
      if (!ticking) {
        requestAnimationFrame(tick);
        ticking = true;
      }
    }, { passive: true });

    // Recalculate zone positions on resize
    let resizeTimer;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(() => { initZones(); tick(); }, 100);
    }, { passive: true });

    // Debug overlay — shows zone progress values. Remove in Task 10.
    const debugEl = document.createElement('div');
    debugEl.style.cssText = 'position:fixed;top:10px;left:10px;background:rgba(0,0,0,0.85);color:#0f0;font:11px/1.6 monospace;padding:8px 12px;z-index:9999;pointer-events:none;border-radius:6px;white-space:pre;';
    document.body.appendChild(debugEl);
    onFrame((p) => {
      debugEl.textContent = Object.entries(p).map(([k, v]) => `${k}: ${v.toFixed(3)}`).join('\n');
    });

    /* ===== Zone 1: Tool Call Packets ===== */
    const PACKETS = [
      { label: 'bash("rm -rf /")',         danger: true },
      { label: 'fs.read("config.yaml")',   danger: false },
      { label: 'sql("DROP TABLE users")',  danger: true },
      { label: 'api.get("/users")',        danger: false },
      { label: 'fs.write("/etc/passwd")',  danger: true },
      { label: 'git.commit("fix typo")',   danger: false },
      { label: 'bash("shutdown -h now")',  danger: true },
      { label: 'db.query("SELECT *")',     danger: false },
    ];

    const packetField = document.getElementById('z1-packet-field');
    const packetEls = [];

    PACKETS.forEach((pkt, i) => {
      const el = document.createElement('div');
      el.className = 'packet';
      el.textContent = pkt.label;
      el.dataset.danger = pkt.danger;
      // Distribute across 4 columns with slight randomness
      const col = i % 4;
      el.style.left = `${8 + col * 23 + (Math.random() * 6 - 3)}%`;
      packetField.appendChild(el);
      packetEls.push({ el, startProgress: 0.25 + (i * 0.07) });
    });

    onFrame((p) => {
      packetEls.forEach(({ el, startProgress }) => {
        const localP = (p.z1 - startProgress) / (1 - startProgress);
        if (localP <= 0) {
          el.style.opacity = '0';
          return;
        }
        const clamped = Math.min(1, localP);
        el.style.opacity = String(Math.min(0.8, clamped * 2.5));
        el.style.transform = `translateY(${clamped * 70}vh)`;
      });
    });

    /* ===== Zone 2A: Ava Appears ===== */
    const z2Ava = document.getElementById('z2-ava');
    const z2Shield = document.getElementById('z2-shield');
    const z2Copy = document.getElementById('z2-copy');

    onFrame((p) => {
      // Ava scales in during first half of z2a
      const avaScale = Math.min(1, p.z2a * 2);
      z2Ava.style.transform = `scale(${avaScale})`;
      z2Ava.style.opacity = String(avaScale);

      // Shield expands after Ava is mostly visible
      const shieldP = Math.max(0, (p.z2a - 0.4) / 0.6);
      z2Shield.style.width = `${shieldP * 100}vw`;
      z2Shield.style.opacity = String(Math.min(1, shieldP * 2));

      // Copy fades in during second half of z2a
      const copyP = Math.max(0, (p.z2a - 0.5) / 0.5);
      z2Copy.style.opacity = String(copyP);
      z2Copy.style.transform = `translateY(${(1 - copyP) * 20}px)`;

      // Hide Ava, shield, and copy during z2b (interception takes over)
      if (p.z2b > 0.05) {
        const fadeOut = Math.max(0, 1 - p.z2b * 4);
        z2Ava.style.opacity = String(fadeOut);
        z2Shield.style.opacity = String(fadeOut);
        z2Copy.style.opacity = String(fadeOut);
      }
    });

    /* ===== Zone 2B: The Interception ===== */
    const INTERCEPTIONS = [
      { label: 'fs.read("config.yaml")',    result: 'allowed',     badge: '\u2713 ALLOWED',     rule: null },
      { label: 'bash("rm -rf /")',          result: 'denied',      badge: '\u2717 DENIED',      rule: 'deny: bash, pattern: "rm -rf"' },
      { label: 'db.query("SELECT *")',      result: 'allowed',     badge: '\u2713 ALLOWED',     rule: null },
      { label: 'sql("DROP TABLE users")',   result: 'denied',      badge: '\u2717 DENIED',      rule: 'deny: sql, pattern: "DROP TABLE"' },
      { label: 'api.call("openai")',        result: 'ratelimited', badge: '\u23f1 RATE LIMITED', rule: 'rate_limit: 100/min' },
      { label: 'fs.write("/etc/passwd")',   result: 'denied',      badge: '\u2717 DENIED',      rule: 'deny: fs.write, pattern: "/etc/*"' },
      { label: 'git.push("origin main")',   result: 'allowed',     badge: '\u2713 ALLOWED',     rule: null },
      { label: 'bash("shutdown -h now")',   result: 'denied',      badge: '\u2717 DENIED',      rule: 'deny: bash, pattern: "shutdown"' },
    ];

    const interceptArea = document.getElementById('z2-intercept-area');
    const interceptEls = [];

    INTERCEPTIONS.forEach((item) => {
      const el = document.createElement('div');
      el.className = 'z2-intercept';
      el.dataset.result = item.result;

      const labelEl = document.createElement('div');
      labelEl.className = 'z2-intercept-label';
      labelEl.textContent = item.label;
      el.appendChild(labelEl);

      const badgeEl = document.createElement('div');
      badgeEl.className = 'z2-intercept-badge';
      badgeEl.textContent = item.badge;
      el.appendChild(badgeEl);

      if (item.rule) {
        const ruleEl = document.createElement('div');
        ruleEl.className = 'z2-intercept-rule';
        ruleEl.textContent = item.rule;
        el.appendChild(ruleEl);
      }

      interceptArea.appendChild(el);
      interceptEls.push(el);
    });

    onFrame((p) => {
      // Show intercept area during z2b
      const areaOpacity = Math.min(1, p.z2b * 3);
      interceptArea.style.opacity = String(areaOpacity);

      // Each interception appears at an evenly-spaced scroll point
      interceptEls.forEach((el, i) => {
        const triggerAt = i / interceptEls.length;
        const localP = (p.z2b - triggerAt) / (1 / interceptEls.length);
        if (localP <= 0) {
          el.style.opacity = '0';
          el.style.transform = 'translateY(-20px)';
          return;
        }
        const clamped = Math.min(1, localP * 2.5);
        el.style.opacity = String(clamped);
        el.style.transform = `translateY(${(1 - clamped) * -20}px)`;
      });

      // Fade out intercepts as z2c begins
      if (p.z2c > 0.05) {
        const fadeOut = Math.max(0, 1 - p.z2c * 3);
        interceptArea.style.opacity = String(fadeOut);
      }
    });

    /* ===== Zone 2C: Architecture Reveal ===== */
    const archEl = document.getElementById('z2-architecture');
    const archBranches = archEl.querySelectorAll('.z2-arch-branch');
    const archCopy = archEl.querySelector('.z2-arch-copy');
    const archCenter = archEl.querySelector('.z2-arch-center');

    onFrame((p) => {
      // Fade in architecture during z2c
      if (p.z2c <= 0) {
        archEl.style.opacity = '0';
        return;
      }

      const archOpacity = Math.min(1, p.z2c * 2.5);
      archEl.style.opacity = String(archOpacity);

      // Center YAML node fades in first
      if (archCenter) {
        archCenter.style.opacity = String(Math.min(1, p.z2c * 3));
      }

      // Each branch line grows and node fades in staggered
      archBranches.forEach((branch, i) => {
        const branchStart = 0.15 + (i * 0.12);
        const branchP = Math.max(0, Math.min(1, (p.z2c - branchStart) / 0.25));
        const line = branch.querySelector('.z2-arch-line');
        const node = branch.querySelector('.z2-arch-node');
        if (line) line.style.height = `${branchP * 60}px`;
        if (node) node.style.opacity = String(Math.max(0, (branchP - 0.3) / 0.7));
      });

      // Bottom copy fades in at the end
      if (archCopy) {
        const copyP = Math.max(0, (p.z2c - 0.7) / 0.3);
        archCopy.style.opacity = String(copyP);
      }
    });

    /* ===== Zone 3: The Protected World ===== */
    const z3Headline = document.querySelector('.z3-headline');
    const z3Sub = document.querySelector('.z3-sub');
    const z3Nodes = document.querySelectorAll('.z3-node');
    const z3Yaml = document.getElementById('z3-yaml');

    onFrame((p) => {
      if (p.z3 <= 0) return;

      // Headline fades in
      const headP = Math.min(1, p.z3 * 3);
      z3Headline.style.opacity = String(headP);
      z3Headline.style.transform = `translateY(${(1 - headP) * 20}px)`;

      // Subtext slightly delayed
      const subP = Math.max(0, Math.min(1, (p.z3 - 0.08) * 3));
      z3Sub.style.opacity = String(subP);
      z3Sub.style.transform = `translateY(${(1 - subP) * 20}px)`;

      // Constellation nodes stagger in
      z3Nodes.forEach((node, i) => {
        const nodeStart = 0.1 + (i * 0.04);
        const nodeP = Math.max(0, Math.min(1, (p.z3 - nodeStart) * 4));
        node.style.opacity = String(nodeP);
        node.style.transform = `translateY(${(1 - nodeP) * 15}px)`;
      });

      // YAML block fades in later
      const yamlP = Math.max(0, Math.min(1, (p.z3 - 0.35) * 3));
      z3Yaml.style.opacity = String(yamlP);
      z3Yaml.style.transform = `translateY(${(1 - yamlP) * 15}px)`;
    });

    // Initialize
    initZones();
    tick();
  </script>
</body>
</html>
