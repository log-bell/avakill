# AvaKill Strict Policy
# Maximum safety â€” deny by default, explicit allowlist only
#
# Includes native tool names from popular AI coding agents:
#   Claude Code, Gemini CLI, Windsurf, OpenAI Codex

version: "1.0"
default_action: deny

policies:
  # --- Only allow explicit read operations ---
  - name: allow-reads-only
    tools:
      # Claude Code
      - "Read"
      - "Glob"
      - "Grep"
      - "LS"
      - "WebFetch"
      # Gemini CLI / Cursor / OpenAI Codex
      - "read_file"
      # Gemini CLI
      - "search_files"
      - "list_files"
      # Windsurf
      - "read_code"
      # OpenAI Codex
      - "list_dir"
      - "grep_files"
      # Generic globs (match canonical names like file_read, file_list)
      - "*_read"
      - "*_get"
      - "*_list"
    action: allow
    rate_limit:
      max_calls: 10
      window: "1m"
    message: "Read operations allowed (rate limited)"

  # --- All write operations require approval ---
  - name: writes-require-approval
    tools:
      # Claude Code
      - "Write"
      - "Edit"
      - "MultiEdit"
      # Gemini CLI
      - "write_file"
      - "edit_file"
      # Windsurf
      - "write_code"
      # OpenAI Codex
      - "apply_patch"
      # Generic globs (match canonical names like file_write, file_edit)
      - "*_write"
      - "*_create"
      - "*_update"
      - "*_edit"
      - "*_put"
      - "*_post"
    action: require_approval
    rate_limit:
      max_calls: 10
      window: "1m"
    message: "Write operations require human approval"

  # --- All execution requires approval (with shell safety) ---
  - name: execution-requires-approval
    tools:
      # Canonical
      - "shell_execute"
      # Claude Code
      - "Bash"
      # Gemini CLI
      - "run_shell_command"
      # Windsurf
      - "run_command"
      # OpenAI Codex
      - "shell"
      - "local_shell"
      - "exec_command"
      # Generic globs
      - "*_execute"
      - "shell_*"
      - "bash_*"
      - "command_*"
      - "code_*"
    action: require_approval
    conditions:
      shell_safe: true
    rate_limit:
      max_calls: 10
      window: "1m"
    message: "Execution operations require human approval (no metacharacters)"

  # --- Block all destructive operations ---
  - name: block-destructive
    tools:
      - "*_delete"
      - "*_drop"
      - "*_destroy"
      - "*_remove"
    action: deny
    message: "Destructive operations are blocked in strict mode"
