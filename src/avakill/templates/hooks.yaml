# AvaKill Hooks Policy
# Designed for use with agent hooks (Claude Code, Gemini CLI, Cursor, Windsurf).
# Includes native tool names so policies match even without normalization.
#
# This template blocks genuinely dangerous operations while allowing
# the full range of tools that AI coding agents need to function.

version: "1.0"
default_action: allow

policies:
  # --- Block catastrophic shell commands ---
  - name: block-dangerous-shell
    tools:
      # Canonical
      - "shell_execute"
      # Claude Code
      - "Bash"
      # Gemini CLI
      - "run_shell_command"
      # Windsurf
      - "run_command"
      # OpenAI Codex
      - "shell"
      - "local_shell"
      - "exec_command"
      # Generic globs
      - "shell_*"
      - "bash_*"
      - "command_*"
    action: deny
    conditions:
      args_match:
        command: ["rm -rf /", "rm -rf /*", "mkfs", "> /dev/", "dd if=", ":(){ :|:& };:"]
    message: "Catastrophic shell command blocked."

  # --- Block destructive database operations ---
  - name: block-destructive-sql
    tools:
      # Canonical
      - "shell_execute"
      # Claude Code
      - "Bash"
      # Gemini CLI
      - "run_shell_command"
      # Windsurf
      - "run_command"
      # OpenAI Codex
      - "shell"
      - "local_shell"
      - "exec_command"
      # Generic globs
      - "shell_*"
      - "bash_*"
      - "command_*"
    action: deny
    conditions:
      args_match:
        command: ["DROP DATABASE", "DROP SCHEMA"]
    message: "Destructive database command blocked."

  # --- Require approval for package management ---
  - name: approve-package-installs
    tools:
      # Canonical
      - "shell_execute"
      # Claude Code
      - "Bash"
      # Gemini CLI
      - "run_shell_command"
      # Windsurf
      - "run_command"
      # OpenAI Codex
      - "shell"
      - "local_shell"
      - "exec_command"
      # Generic globs
      - "shell_*"
      - "bash_*"
      - "command_*"
    action: require_approval
    conditions:
      args_match:
        command: ["pip install", "npm install -g", "brew install"]
    message: "Package installation requires approval."

  # --- Rate limit agent spawning ---
  - name: rate-limit-agents
    tools:
      - "agent_spawn"
      # Claude Code
      - "Task"
    action: allow
    rate_limit:
      max_calls: 20
      window: "1m"

  # --- Log everything else (allow, with audit trail) ---
  - name: log-all
    tools:
      - "all"
    action: allow
