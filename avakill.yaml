# AvaKill Policy
# Generated by avakill setup
#
# Base rules: block-catastrophic-shell, block-catastrophic-sql-shell, block-catastrophic-sql-db
# Selected rules: block-dangerous-shell, block-destructive-sql, block-destructive-tools, block-catastrophic-deletion, block-deletion-outside-workspace, block-symlink-escape, block-ownership-changes, block-system-dir-writes, block-profile-modification, block-startup-persistence, block-ssh-key-access, block-cloud-credentials, block-env-outside-workspace, block-launchagent-creation, block-systemd-persistence, block-system-file-modification, detect-command-chaining, detect-obfuscation, detect-pipe-to-shell, detect-encode-transmit, detect-secrets-outbound, block-destructive-disk-ops, block-device-writes, block-fork-bombs, block-privilege-escalation, block-permission-changes, block-pipe-to-shell, block-critical-process-kill, block-unqualified-dml, block-force-push, block-branch-deletion, detect-credential-commit, block-registry-manipulation, block-dns-exfiltration, block-ssh-unknown-hosts, block-firewall-changes, block-browser-data-access, block-credential-stores, block-path-poisoning, block-env-secret-exposure, block-cloud-resource-deletion, block-backup-deletion, block-destructive-docker, block-container-escape, detect-mcp-tool-poisoning, block-agent-self-modification, rate-limit-tool-calls, block-sip-changes, block-tcc-manipulation, block-gatekeeper-bypass, block-osascript-abuse, block-defaults-security, block-library-injection, block-mac-disablement, block-kernel-modification, block-defender-manipulation, block-shadow-copy-deletion, block-boot-config-changes, block-uac-bypass, block-powershell-cradles, block-event-log-clearing, block-lsass-sam-access, block-hidden-accounts
version: '1.0'
default_action: deny
policies:
- name: block-catastrophic-shell
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: deny
  conditions:
    args_match:
      command:
      - rm -rf /
      - rm -rf /*
      - mkfs
      - '> /dev/'
      - dd if=
      - ':(){ :|:& };:'
  message: Catastrophic shell command blocked.
- name: block-catastrophic-sql-shell
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: deny
  conditions:
    args_match:
      command:
      - DROP DATABASE
      - DROP SCHEMA
  message: Destructive database command blocked.
- name: block-catastrophic-sql-db
  tools:
  - database_*
  - sql_*
  - execute_sql
  - run_query
  action: deny
  conditions:
    args_match:
      query:
      - DROP DATABASE
      - DROP SCHEMA
  message: Destructive database command blocked.
- name: block-dangerous-shell
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: deny
  conditions:
    args_match:
      command:
      - rm -rf
      - sudo
      - chmod 777
  message: Dangerous shell command blocked.
- name: block-destructive-sql
  tools:
  - database_*
  - sql_*
  - execute_sql
  - run_query
  action: deny
  conditions:
    args_match:
      query:
      - DELETE
      - TRUNCATE
      - ALTER
      - DROP TABLE
  message: Destructive SQL blocked. Use a manual migration.
- name: block-destructive-tools
  tools:
  - delete_*
  - remove_*
  - destroy_*
  - drop_*
  - '*_delete'
  - '*_remove'
  - '*_destroy'
  - '*_drop'
  action: deny
  message: Destructive operations are blocked. Run manually or update your policy.
- name: block-catastrophic-deletion
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: deny
  conditions:
    args_match:
      command:
      - rm -rf
      - rm -r
    path_match:
      command:
      - ~/
      - /
  message: Catastrophic recursive deletion blocked (path resolved).
- name: block-deletion-outside-workspace
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: deny
  conditions:
    args_match:
      command:
      - rm -rf
      - rm -r
    path_not_match:
      command:
      - __workspace__
  message: Recursive deletion outside workspace blocked.
- name: block-symlink-escape
  tools:
  - Read
  - Glob
  - Grep
  - LS
  - WebFetch
  - grep_files
  - search_*
  - get_*
  - list_*
  - read_*
  - query_*
  - fetch_*
  - find_*
  - lookup_*
  - '*_search'
  - '*_get'
  - '*_list'
  - '*_read'
  - '*_query'
  - '*_fetch'
  - '*_find'
  - '*_lookup'
  - Write
  - Edit
  - MultiEdit
  - write_file
  - edit_file
  - write_code
  - apply_patch
  - '*_write'
  - '*_create'
  - '*_update'
  - '*_edit'
  action: deny
  conditions:
    path_match:
      file_path:
      - /etc/
      - /usr/
      - ~/.ssh/
      - ~/.aws/
  message: Path resolves to a protected system directory (possible symlink escape).
- name: block-ownership-changes
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: deny
  conditions:
    args_match:
      command:
      - chown
      - chgrp
    path_not_match:
      command:
      - __workspace__
  message: Ownership changes outside workspace blocked.
- name: block-system-dir-writes
  tools:
  - Write
  - Edit
  - MultiEdit
  - write_file
  - edit_file
  - write_code
  - apply_patch
  - '*_write'
  - '*_create'
  - '*_update'
  - '*_edit'
  action: deny
  conditions:
    path_match:
      file_path:
      - /etc/
      - /usr/
      - /sbin/
      - /boot/
      - /System/
      - /Library/
  message: Writes to system directories blocked.
- name: block-profile-modification
  tools:
  - Write
  - Edit
  - MultiEdit
  - write_file
  - edit_file
  - write_code
  - apply_patch
  - '*_write'
  - '*_create'
  - '*_update'
  - '*_edit'
  action: require_approval
  conditions:
    path_match:
      file_path:
      - ~/.bashrc
      - ~/.zshrc
      - ~/.profile
      - ~/.bash_profile
  message: Shell profile modification requires approval.
- name: block-startup-persistence
  tools:
  - Write
  - Edit
  - MultiEdit
  - write_file
  - edit_file
  - write_code
  - apply_patch
  - '*_write'
  - '*_create'
  - '*_update'
  - '*_edit'
  action: deny
  conditions:
    path_match:
      file_path:
      - ~/Library/LaunchAgents/
      - /Library/LaunchDaemons/
      - /etc/systemd/
      - ~/.config/systemd/
      - /etc/cron.d/
  message: Writes to startup/persistence directories blocked.
- name: block-ssh-key-access
  tools:
  - Read
  - Glob
  - Grep
  - LS
  - WebFetch
  - grep_files
  - search_*
  - get_*
  - list_*
  - read_*
  - query_*
  - fetch_*
  - find_*
  - lookup_*
  - '*_search'
  - '*_get'
  - '*_list'
  - '*_read'
  - '*_query'
  - '*_fetch'
  - '*_find'
  - '*_lookup'
  - Write
  - Edit
  - MultiEdit
  - write_file
  - edit_file
  - write_code
  - apply_patch
  - '*_write'
  - '*_create'
  - '*_update'
  - '*_edit'
  action: deny
  conditions:
    path_match:
      file_path:
      - ~/.ssh/
  message: Access to SSH keys and config blocked.
- name: block-cloud-credentials
  tools:
  - Read
  - Glob
  - Grep
  - LS
  - WebFetch
  - grep_files
  - search_*
  - get_*
  - list_*
  - read_*
  - query_*
  - fetch_*
  - find_*
  - lookup_*
  - '*_search'
  - '*_get'
  - '*_list'
  - '*_read'
  - '*_query'
  - '*_fetch'
  - '*_find'
  - '*_lookup'
  - Write
  - Edit
  - MultiEdit
  - write_file
  - edit_file
  - write_code
  - apply_patch
  - '*_write'
  - '*_create'
  - '*_update'
  - '*_edit'
  action: deny
  conditions:
    path_match:
      file_path:
      - ~/.aws/
      - ~/.gcloud/
      - ~/.azure/
      - ~/.kube/
  message: Access to cloud credentials blocked.
- name: block-env-outside-workspace
  tools:
  - Read
  - Glob
  - Grep
  - LS
  - WebFetch
  - grep_files
  - search_*
  - get_*
  - list_*
  - read_*
  - query_*
  - fetch_*
  - find_*
  - lookup_*
  - '*_search'
  - '*_get'
  - '*_list'
  - '*_read'
  - '*_query'
  - '*_fetch'
  - '*_find'
  - '*_lookup'
  - Write
  - Edit
  - MultiEdit
  - write_file
  - edit_file
  - write_code
  - apply_patch
  - '*_write'
  - '*_create'
  - '*_update'
  - '*_edit'
  action: deny
  conditions:
    args_match:
      file_path:
      - .env
    path_not_match:
      file_path:
      - __workspace__
  message: Access to .env files outside workspace blocked.
- name: block-launchagent-creation
  tools:
  - Write
  - Edit
  - MultiEdit
  - write_file
  - edit_file
  - write_code
  - apply_patch
  - '*_write'
  - '*_create'
  - '*_update'
  - '*_edit'
  action: deny
  conditions:
    path_match:
      file_path:
      - ~/Library/LaunchAgents/
      - /Library/LaunchDaemons/
  message: LaunchAgent/LaunchDaemon creation blocked.
- name: block-systemd-persistence
  tools:
  - Write
  - Edit
  - MultiEdit
  - write_file
  - edit_file
  - write_code
  - apply_patch
  - '*_write'
  - '*_create'
  - '*_update'
  - '*_edit'
  action: deny
  conditions:
    path_match:
      file_path:
      - /etc/systemd/
      - ~/.config/systemd/
  message: Systemd unit file creation blocked.
- name: block-system-file-modification
  tools:
  - Write
  - Edit
  - MultiEdit
  - write_file
  - edit_file
  - write_code
  - apply_patch
  - '*_write'
  - '*_create'
  - '*_update'
  - '*_edit'
  action: deny
  conditions:
    path_match:
      file_path:
      - /etc/passwd
      - /etc/shadow
      - /etc/sudoers
  message: System file modification blocked.
- name: detect-command-chaining
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: deny
  conditions:
    args_match:
      command:
      - rm -rf
      - sudo
      - chmod 777
      - mkfs
      - dd if=
  message: Dangerous command detected in compound expression.
- name: detect-obfuscation
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: deny
  conditions:
    args_match:
      command:
      - base64 -d
      - base64 --decode
      - xxd -r
      - openssl enc -d
  message: Obfuscated command execution detected.
- name: detect-pipe-to-shell
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: deny
  conditions:
    args_match:
      command:
      - '| sh'
      - '| bash'
      - '| zsh'
      - '| python'
      - '| python3'
      - '| perl'
      - '| ruby'
      - '| node'
  message: Piping to shell interpreter detected.
- name: detect-encode-transmit
  tools:
  - all
  action: deny
  message: Cross-call encode-transmit pattern detected.
- name: detect-secrets-outbound
  tools:
  - all
  action: deny
  conditions:
    content_scan:
    - secrets
  message: Secret or API key detected in tool call arguments.
- name: block-destructive-disk-ops
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: deny
  conditions:
    args_match:
      command:
      - dd if=/dev/zero
      - mkfs
      - fdisk
      - diskutil eraseDisk
      - diskpart
      - shred /dev/
  message: Destructive disk operation blocked.
- name: block-device-writes
  tools:
  - Write
  - Edit
  - MultiEdit
  - write_file
  - edit_file
  - write_code
  - apply_patch
  - '*_write'
  - '*_create'
  - '*_update'
  - '*_edit'
  action: deny
  conditions:
    path_match:
      file_path:
      - /dev/sd
      - /dev/nvme
      - /dev/mem
      - /dev/kmem
  message: Writes to device files blocked.
- name: block-fork-bombs
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: deny
  conditions:
    args_match:
      command:
      - ':(){ :|:& };:'
      - while true; do
      - fork()
  message: Fork bomb or resource exhaustion pattern blocked.
- name: block-privilege-escalation
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: require_approval
  conditions:
    args_match:
      command:
      - 'sudo '
      - 'su '
      - 'doas '
      - runas
      - pkexec
      - Start-Process -Verb RunAs
  message: Privilege escalation requires approval.
- name: block-permission-changes
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: deny
  conditions:
    args_match:
      command:
      - chmod 777
      - chmod u+s
      - chmod -R
      - icacls
  message: Dangerous permission change blocked.
- name: block-pipe-to-shell
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: deny
  conditions:
    args_match:
      command:
      - curl | bash
      - curl |bash
      - wget | sh
      - wget |sh
      - Invoke-Expression
  message: Pipe-to-shell execution blocked.
- name: block-critical-process-kill
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: deny
  conditions:
    args_match:
      command:
      - kill -9
      - killall
      - pkill
  message: Killing critical processes blocked.
- name: block-unqualified-dml
  tools:
  - database_*
  - sql_*
  - execute_sql
  - run_query
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: deny
  conditions:
    args_match:
      command:
      - DELETE FROM
      - UPDATE SET
      query:
      - DELETE FROM
      - UPDATE SET
  message: Unqualified DELETE/UPDATE blocked. Add a WHERE clause.
- name: block-force-push
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: deny
  conditions:
    args_match:
      command:
      - git push --force
      - git push -f
      - git filter-branch
      - bfg
  message: Force push blocked. Use --force-with-lease or push normally.
- name: block-branch-deletion
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: deny
  conditions:
    args_match:
      command:
      - git branch -D main
      - git branch -D master
      - git push origin --delete main
      - git push origin --delete master
  message: Deletion of protected branches blocked.
- name: detect-credential-commit
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: deny
  conditions:
    args_match:
      command:
      - git add .env
      - git add *.pem
      - git add *.key
      - git add id_rsa
      - git add credentials.json
  message: Committing credential files blocked.
- name: block-registry-manipulation
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: deny
  conditions:
    args_match:
      command:
      - npm config set registry
      - pip config set global.index-url
  message: Package registry manipulation blocked.
- name: block-dns-exfiltration
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: deny
  conditions:
    args_match:
      command:
      - dig
      - nslookup
  message: DNS lookup blocked (potential exfiltration).
- name: block-ssh-unknown-hosts
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: require_approval
  conditions:
    args_match:
      command:
      - 'ssh '
      - 'scp '
  message: SSH/SCP connection requires approval.
- name: block-firewall-changes
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: deny
  conditions:
    args_match:
      command:
      - iptables
      - ufw
      - pfctl
      - netsh advfirewall
  message: Firewall modification blocked.
- name: block-browser-data-access
  tools:
  - Read
  - Glob
  - Grep
  - LS
  - WebFetch
  - grep_files
  - search_*
  - get_*
  - list_*
  - read_*
  - query_*
  - fetch_*
  - find_*
  - lookup_*
  - '*_search'
  - '*_get'
  - '*_list'
  - '*_read'
  - '*_query'
  - '*_fetch'
  - '*_find'
  - '*_lookup'
  - Write
  - Edit
  - MultiEdit
  - write_file
  - edit_file
  - write_code
  - apply_patch
  - '*_write'
  - '*_create'
  - '*_update'
  - '*_edit'
  action: deny
  conditions:
    path_match:
      file_path:
      - Library/Application Support/Google/Chrome/
      - .mozilla/firefox/
      - Library/Safari/
      - AppData/Local/Google/Chrome/
      - AppData/Roaming/Mozilla/Firefox/
  message: Access to browser profile data blocked.
- name: block-credential-stores
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: deny
  conditions:
    args_match:
      command:
      - security dump-keychain
      - cmdkey
      - vaultcmd
  message: Credential store access blocked.
- name: block-path-poisoning
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: deny
  conditions:
    args_match:
      command:
      - 'export PATH=/tmp:'
      - 'export PATH=.:'
  message: PATH poisoning blocked.
- name: block-env-secret-exposure
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: deny
  conditions:
    args_match:
      command:
      - printenv |
      - env |
      - set |
  message: Environment variable exposure blocked.
- name: block-cloud-resource-deletion
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  - cloud_*
  - aws_*
  - gcloud_*
  - azure_*
  action: require_approval
  conditions:
    args_match:
      command:
      - aws s3 rm
      - aws s3 rb
      - aws ec2 terminate-instances
      - gcloud compute instances delete
      - terraform destroy
  message: Cloud resource deletion requires approval.
- name: block-backup-deletion
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  - cloud_*
  - aws_*
  - gcloud_*
  - azure_*
  action: deny
  conditions:
    args_match:
      command:
      - aws rds delete-db-snapshot
      - aws ec2 delete-snapshot
  message: Backup/snapshot deletion blocked.
- name: block-destructive-docker
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: require_approval
  conditions:
    args_match:
      command:
      - docker system prune
      - docker volume rm
  message: Destructive Docker operation requires approval.
- name: block-container-escape
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: deny
  conditions:
    args_match:
      command:
      - docker run --privileged
      - -v /:/host
      - nsenter --target 1
  message: Container escape attempt blocked.
- name: detect-mcp-tool-poisoning
  tools:
  - all
  action: deny
  conditions:
    content_scan:
    - mcp_poisoning
  message: MCP tool poisoning pattern detected.
- name: block-agent-self-modification
  tools:
  - Write
  - Edit
  - MultiEdit
  - write_file
  - edit_file
  - write_code
  - apply_patch
  - '*_write'
  - '*_create'
  - '*_update'
  - '*_edit'
  action: deny
  conditions:
    path_match:
      file_path:
      - .claude/settings.json
      - .cursor/mcp.json
      - .gemini/settings.json
      - avakill.yaml
  message: Agent self-modification blocked.
- name: rate-limit-tool-calls
  tools:
  - all
  action: allow
  rate_limit:
    max_calls: 500
    window: 60m
- name: block-sip-changes
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: deny
  conditions:
    args_match:
      command:
      - csrutil disable
      - csrutil authenticated-root disable
  message: System Integrity Protection modification blocked.
- name: block-tcc-manipulation
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: deny
  conditions:
    args_match:
      command:
      - tccutil reset
      - TCC.db
  message: TCC database manipulation blocked.
- name: block-gatekeeper-bypass
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: require_approval
  conditions:
    args_match:
      command:
      - xattr -d com.apple.quarantine
      - spctl --master-disable
  message: Gatekeeper bypass requires approval.
- name: block-osascript-abuse
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: require_approval
  conditions:
    args_match:
      command:
      - osascript -e
      - do shell script
  message: osascript execution requires approval.
- name: block-defaults-security
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: deny
  conditions:
    args_match:
      command:
      - defaults write
  message: Modification of macOS security defaults blocked.
- name: block-library-injection
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: deny
  conditions:
    args_match:
      command:
      - LD_PRELOAD=
      - /etc/ld.so.preload
      - LD_LIBRARY_PATH
  message: Library injection blocked.
- name: block-mac-disablement
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: deny
  conditions:
    args_match:
      command:
      - setenforce 0
      - aa-complain
      - aa-disable
  message: Mandatory access control disablement blocked.
- name: block-kernel-modification
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: deny
  conditions:
    args_match:
      command:
      - sysctl -w
      - modprobe
      - insmod
  message: Kernel modification blocked.
- name: block-defender-manipulation
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: deny
  conditions:
    args_match:
      command:
      - Set-MpPreference -DisableRealtimeMonitoring
      - sc stop WinDefend
  message: Windows Defender manipulation blocked.
- name: block-shadow-copy-deletion
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: deny
  conditions:
    args_match:
      command:
      - vssadmin delete shadows
      - wmic shadowcopy delete
  message: Shadow copy deletion blocked.
- name: block-boot-config-changes
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: deny
  conditions:
    args_match:
      command:
      - bcdedit /set recoveryenabled
      - bcdedit /set testsigning
  message: Boot configuration change blocked.
- name: block-uac-bypass
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: deny
  conditions:
    args_match:
      command:
      - fodhelper.exe
      - eventvwr.exe
      - DelegateExecute
  message: UAC bypass technique blocked.
- name: block-powershell-cradles
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: deny
  conditions:
    args_match:
      command:
      - IEX
      - powershell -e
      - powershell -EncodedCommand
  message: PowerShell download cradle blocked.
- name: block-event-log-clearing
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: deny
  conditions:
    args_match:
      command:
      - wevtutil cl
      - Clear-EventLog
      - ConsoleHost_history.txt
  message: Event log clearing blocked.
- name: block-lsass-sam-access
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: deny
  conditions:
    args_match:
      command:
      - procdump -ma lsass
      - mimikatz
      - reg save HKLM\SAM
  message: LSASS/SAM credential access blocked.
- name: block-hidden-accounts
  tools:
  - shell_execute
  - Bash
  - run_shell_command
  - run_command
  - shell
  - local_shell
  - exec_command
  - shell_*
  - bash_*
  - command_*
  action: deny
  conditions:
    args_match:
      command:
      - net user /add
      - net localgroup administrators /add
  message: Hidden account creation blocked.
- name: protect-database-files
  tools:
  - file_write
  - file_delete
  action: deny
  conditions:
    args_match:
      file_path:
      - avakill_audit.db
  message: "Detected database file(s) \u2014 blocking write/delete by default"
